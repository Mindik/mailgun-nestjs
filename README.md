<h1 align="center"></h1>

<div align="center">
  <a href="https://nestjs.com/" target="_blank">
    <img src="https://nestjs.com/img/logo_text.svg" width="150" alt="Nest Logo" />
  </a>
</div>

<h3 align="center">Mailgun -- generated by @nestjsplus/dyn-schematics</h3>
<br/>
<div align="center">

[![MIT License](https://img.shields.io/apm/l/atomic-design-ui.svg)](https://github.com/Mindik/mailgun-nestjs/blob/main/LICENSE)
[![Built with NestJS](https://img.shields.io/badge/built%20with-NestJs-red.svg)](https://nestjs.com)
[![Built with @nestjsplus/dyn-schematics](https://img.shields.io/badge/Built%20with-%40nestjsplus%2Fdyn--schematics-brightgreen)](https://github.com/nestjsplus/dyn-schematics)

</div>

<br/>

## About

The module is a thin wrapper for the [Mailgun API](https://www.npmjs.com/package/mailgun.js).

<br/>

## Installation

```bash
npm i @mindik/mailgun-nestjs
```

<br/>

## Quick Start

Add in your tsconfig.json

```json
{
  "esModuleInterop": true
}
```

Import the module and pass options to it

```TypeScript
// app.app-module.ts
import { AppModule } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { MailgunModule } from '@mindik/mailgun-nestjs';

@AppModule({
  imports: [
    MailgunModule.forRoot({
      /**
       * username: string;
       * key: string;
       * url?: string;
       * public_key?: string;
       * timeout?: number;
       */
    })
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```
<br/>

..or use forRootAsync({ })

```TypeScript
// app.app-module.ts
import { AppModule } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { MailgunModule } from '@mindik/mailgun-nestjs';

@AppModule({
  imports: [
    MailgunModule.forRootAsync({
      imports: [/** ConfigModule */],
      /** 
        * useExisting 
        * useFactory 
        * useClass 
      */
      useFactory: async () => (
        {
          /**
           * username: string;
           * key: string;
           * url?: string;
           * public_key?: string;
           * timeout?: number;
           */
        }
      ), 
      inject: [/** ConfigService */]
    }),
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```
<br/>

Inject Mailgun in your service


```TypeScript
// app.service.ts
import { InjectMailgun } from '@mindik/mailgun-nestjs';
import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  constructor(
    /*
      or 
      @Inject(MAILGUN_TOKEN) private readonly mail
    */
    @InjectMailgun() private readonly mg
  ) {}

  async test() {
    return this.mg.messages
      .create('sandbox-123.mailgun.org', {
        from: 'Excited User <mailgun@sandbox-123.mailgun.org>',
        to: ['test@example.com'],
        subject: 'Hello',
        text: 'Testing some Mailgun awesomness!',
        html: '<h1>Testing some Mailgun awesomness!</h1>',
      })
      .then((msg) => console.log(msg)) // logs response data
      .catch((err) => console.log(err)); // logs any error
  }
}
```

You can use a decorator

```TypeScript
@InjectMailgun() private readonly mg
```

 that is an alias for a longer entry
 
```TypeScript
@Inject(MAILGUN_TOKEN) private readonly mg
```

<br/>
Further use in the application is no different from other modules...

Add the export to the decorator @AppModule()

```TypeScript
// app.app-module.ts
import { AppModule } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { MailgunModule } from '@mindik/mailgun-nestjs';

@AppModule({
  imports: [
    MailgunModule.forRoot({
      /**
       * username: string;
       * key: string;
       * url?: string;
       * public_key?: string;
       * timeout?: number;
       */
    })
  ],
  controllers: [AppController],
  providers: [AppService],
  exports: [AppService],
})
export class AppModule {}
```

Import service in some module

```TypeScript
// some.app-module.ts
import { AppModule } from '@nestjs/common';
import { AppService } from 'src/app.service';
import { SomeController } from './some.controller';
import { SomeService } from './some.service';

@AppModule({
  controllers: [SomeController],
  providers: [AppService, SomeService],
})
export class SomeModule {}
```

Use in your some service

```TypeScript
// some.service.ts
import { Injectable } from '@nestjs/common';
import { AppService } from 'src/app.service';

@Injectable()
export class SomeService {
  constructor(private readonly appService: AppService) {}

  async test(): Promise<any> {
    return 'SOME SERVICE ' + (await this.appService.test());
  }
}
```
<br/>

## Contributing

Any suggestions for improving the project are welcome.

1. Fork the repository
2. Create your branch (git checkout -b my-branch)
3. Commit any changes to your branch
4. Push your changes to your remote branch
5. Open a pull request

<br/>

## License

Distributed under the MIT License. See [LICENSE](https://github.com/Mindik/mailgun-nestjs/blob/main/LICENSE) for more information.

<br/>

## Acknowledgements

 * [nestjs](https://nestjs.com/)

 * [@nestjsplus/dyn-schematics](https://github.com/nestjsplus/dyn-schematics)

 * [@mailgun/mailgun.js](https://www.npmjs.com/package/mailgun.js)
